<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéì Shared Academic Tracker</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <!-- Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* All the original, aesthetic CSS is back */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: #f4f7f6; color: #333; line-height: 1.6; position: relative; min-height: 100vh; padding-bottom: 60px; }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; display: grid; grid-template-columns: 1fr 2fr; gap: 25px; }
        .card { background: #ffffff; border-radius: 12px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        h1, h2, h3 { color: #2c3e50; margin-bottom: 10px; font-weight: 600; }
        h1 { grid-column: 1 / -1; text-align: center; color: #34495e; padding-bottom: 15px; border-bottom: 2px solid #e0e0e0; }
        .left-column { grid-column: 1 / 2; display: flex; flex-direction: column; gap: 25px; }
        .right-column { grid-column: 2 / 3; display: flex; flex-direction: column; gap: 25px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
        button { width: 100%; padding: 12px; background-color: #3498db; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; }
        .metrics { display: flex; gap: 20px; }
        .metric-card { flex: 1; text-align: center; padding: 20px; }
        .review-section { grid-column: 1 / -1; margin-top: 25px; }
        .review-item { border-bottom: 1px solid #eee; padding: 10px 0; }
        footer { text-align: center; margin-top: 40px; color: #7f8c8d; font-size: 0.9em; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } .left-column, .right-column, .review-section, h1 { grid-column: 1 / -1; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéì Shared Academic Tracker</h1>

        <!-- Left Column for Controls -->
        <div class="left-column">
            <div class="profile-switcher card">
                <h2>üë§ View Dashboard</h2>
                <div class="form-group">
                    <label for="profileSelector">Select a Profile to View</label>
                    <select id="profileSelector"><option>Loading users...</option></select>
                </div>
            </div>

            <div class="entry-form card">
                <h2>üìù Add / Update Score</h2>
                <form id="scoreForm">
                    <div class="form-group"><label for="userName">Your Name</label><input type="text" id="userName" placeholder="Enter your name" required></div>
                    <div class="form-group"><label for="subject">Subject</label><select id="subject" required></select></div>
                    <div class="form-group"><label for="exam">Exam</label><select id="exam" required></select></div>
                    <div class="form-group"><label for="score">Score</label><input type="number" id="score" step="0.5" min="0" required></div>
                    <div class="form-group"><label for="weaknesses">Weaknesses</label><textarea id="weaknesses" placeholder="e.g., Trigonometry formulas..."></textarea></div>
                    <button type="submit">üíæ Save to Cloud</button>
                </form>
            </div>
        </div>

        <!-- Right Column for Displaying Data -->
        <div class="right-column">
            <div class="metrics">
                <div class="metric-card card"><h3>Overall Average</h3><p id="overallAverage">--%</p></div>
                <div class="metric-card card"><h3>Best Subject</h3><p id="bestSubject">--</p></div>
            </div>
            <div class="card"><h2>üìä Overall Performance</h2><canvas id="overallChart"></canvas></div>
            <div class="card"><h2>üìà Subject Progress</h2><canvas id="subjectChart"></canvas></div>
        </div>

        <div class="review-section card">
            <h2>üß† Weakness Review</h2>
            <div id="weakness-list"><p>Select a profile to view their notes.</p></div>
        </div>
    </div>
    
    <footer>Made by Parth Soni with love ‚ù§Ô∏è</footer>

    <script>
        // --- START OF FIREBASE SETUP ---
        // PASTE YOUR FIREBASE CONFIGURATION OBJECT HERE
        const firebaseConfig = {
            // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyARD2QGMkCZJUBe5WoS4vJ7e1OLYk3S1go",
  authDomain: "shared-score-tracker.firebaseapp.com",
  projectId: "shared-score-tracker",
  storageBucket: "shared-score-tracker.firebasestorage.app",
  messagingSenderId: "280638170513",
  appId: "1:280638170513:web:60834480bf6b43dae46630",
  measurementId: "G-Q7L8BRKW5L"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
        };
        // --- END OF FIREBASE SETUP ---

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const scoresCollection = db.collection('scores');

        // --- GLOBAL STATE & CONFIG ---
        let allUsersData = {};
        let currentProfile = '';
        let charts = {};
        const SUBJECTS = ["Hindi", "English", "Mathematics", "Science", "SST", "AI"];
        const EXAMS = ["MT1", "MT2", "MT3", "PT1", "PT2", "Pre-boards"];
        const MAX_MARKS = { "Pre-boards": 80, "default": 40 };

        // --- DOM REFERENCES ---
        const profileSelector = document.getElementById('profileSelector');
        const form = document.getElementById('scoreForm');
        // ... (all other DOM elements are grabbed inside render functions)

        // --- REAL-TIME DATA LISTENER ---
        scoresCollection.onSnapshot(snapshot => {
            snapshot.docs.forEach(doc => {
                allUsersData[doc.id] = doc.data();
            });
            updateProfileSelector();
            renderDashboardForProfile(currentProfile);
        });

        // --- EVENT LISTENERS ---
        profileSelector.addEventListener('change', (e) => {
            currentProfile = e.target.value;
            renderDashboardForProfile(currentProfile);
        });

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const userName = document.getElementById('userName').value.trim().toLowerCase();
            if (!userName) return alert('Please enter your name!');
            
            const subject = document.getElementById('subject').value;
            const exam = document.getElementById('exam').value;
            const score = parseFloat(document.getElementById('score').value);
            const weakness = document.getElementById('weaknesses').value;
            const max = MAX_MARKS[exam] || MAX_MARKS.default;

            const updateData = { [`${subject}.${exam}`]: { score, max, weakness } };
            scoresCollection.doc(userName).set(updateData, { merge: true })
                .then(() => {
                    alert('Score saved successfully!');
                    form.reset();
                });
        });

        // --- RENDER FUNCTIONS ---
        function updateProfileSelector() {
            const users = Object.keys(allUsersData);
            profileSelector.innerHTML = '<option value="">-- Select Profile --</option>';
            users.forEach(user => {
                const displayName = user.charAt(0).toUpperCase() + user.slice(1);
                profileSelector.innerHTML += `<option value="${user}">${displayName}</option>`;
            });
            profileSelector.value = currentProfile; // Keep the selected profile
        }

        function renderDashboardForProfile(profileName) {
            const userData = allUsersData[profileName] || {};
            
            renderMetrics(userData);
            renderOverallChart(userData);
            renderSubjectChart(userData); // Start with a blank chart initially
            renderWeaknessList(userData);
        }

        function renderMetrics(data) {
            const avgEl = document.getElementById('overallAverage');
            const bestSubEl = document.getElementById('bestSubject');
            
            const allScores = [];
            const subjectAverages = {};

            for (const subject in data) {
                let totalPercentage = 0;
                let count = 0;
                for (const exam in data[subject]) {
                    const entry = data[subject][exam];
                    const percentage = (entry.score / entry.max * 100);
                    allScores.push(percentage);
                    totalPercentage += percentage;
                    count++;
                }
                if (count > 0) subjectAverages[subject] = totalPercentage / count;
            }

            if (allScores.length > 0) {
                const overallAvg = allScores.reduce((a, b) => a + b, 0) / allScores.length;
                avgEl.textContent = `${overallAvg.toFixed(2)}%`;
                bestSubEl.textContent = Object.keys(subjectAverages).reduce((a, b) => subjectAverages[a] > subjectAverages[b] ? a : b);
            } else {
                avgEl.textContent = '--%';
                bestSubEl.textContent = '--';
            }
        }
        
        function renderOverallChart(data) {
            if (charts.overall) charts.overall.destroy();
            const subjectAverages = {};
            for (const subject in data) {
                const exams = Object.values(data[subject]);
                const avg = exams.reduce((acc, curr) => acc + (curr.score / curr.max * 100), 0) / exams.length;
                subjectAverages[subject] = avg;
            }

            const ctx = document.getElementById('overallChart').getContext('2d');
            charts.overall = new Chart(ctx, { type: 'bar', data: { labels: SUBJECTS, datasets: [{ label: 'Average Score %', data: SUBJECTS.map(s => subjectAverages[s]), backgroundColor: 'rgba(52, 152, 219, 0.7)' }] }, options: { scales: { y: { beginAtZero: true, max: 100 } } } });
        }

        function renderSubjectChart(data) {
            if (charts.subject) charts.subject.destroy();
            // This chart needs a subject selected. For now, it will be blank.
            // A future improvement could be to add a second dropdown for subject selection.
            const subjectsWithData = Object.keys(data);
            if (subjectsWithData.length === 0) return;

            const firstSubject = subjectsWithData[0];
            const subjectData = data[firstSubject];
            const labels = EXAMS.filter(exam => subjectData[exam]);
            const scores = labels.map(exam => (subjectData[exam].score / subjectData[exam].max * 100));

            const ctx = document.getElementById('subjectChart').getContext('2d');
            charts.subject = new Chart(ctx, { type: 'line', data: { labels: labels, datasets: [{ label: `Progress in ${firstSubject}`, data: scores, borderColor: '#e74c3c', tension: 0.1 }] }, options: { scales: { y: { beginAtZero: true, max: 100 } } } });
        }
        
        function renderWeaknessList(data) {
            const listEl = document.getElementById('weakness-list');
            listEl.innerHTML = '';
            let hasWeaknesses = false;
            for (const subject in data) {
                for (const exam in data[subject]) {
                    if (data[subject][exam].weakness) {
                        hasWeaknesses = true;
                        const item = document.createElement('div');
                        item.className = 'review-item';
                        item.innerHTML = `<strong>${subject} (${exam}):</strong> ${data[subject][exam].weakness}`;
                        listEl.appendChild(item);
                    }
                }
            }
            if (!hasWeaknesses) listEl.innerHTML = '<p>No weaknesses noted for this profile.</p>';
        }

        // --- INITIALIZE FORM ---
        const subjectSelect = document.getElementById('subject');
        const examSelect = document.getElementById('exam');
        SUBJECTS.forEach(sub => subjectSelect.innerHTML += `<option value="${sub}">${sub}</option>`);
        EXAMS.forEach(ex => examSelect.innerHTML += `<option value="${ex}">${ex}</option>`);

    </script>
</body>
</html>
